<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expert Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* GitHub-like styles */
        body {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
        }
        
        .gh-btn-primary {
            background-color: #2da44e;
            color: #ffffff;
            border: 1px solid rgba(27,31,36,0.15);
            box-shadow: 0 1px 0 rgba(27,31,36,0.1);
        }
        .gh-btn-primary:hover {
            background-color: #2c974b;
        }

        .gh-btn-secondary {
            background-color: #f6f8fa;
            color: #24292f;
            border: 1px solid rgba(27,31,36,0.15);
            box-shadow: 0 1px 0 rgba(27,31,36,0.04);
        }
        .gh-btn-secondary:hover {
            background-color: #f3f4f6;
            border-color: rgba(27,31,36,0.15);
        }

        .gh-input {
            border: 1px solid #d0d7de;
            background-color: #ffffff;
            box-shadow: inset 0 1px 2px rgba(27,31,36,0.075);
        }
        .gh-input:focus {
            border-color: #0969da;
            outline: none;
            box-shadow: 0 0 0 3px rgba(9,105,218,0.3);
        }

        .gh-card {
            background-color: #ffffff;
            border: 1px solid #d0d7de;
            border-radius: 6px;
        }
        
        .gh-link {
            color: #0969da;
            text-decoration: none;
        }
        .gh-link:hover {
            text-decoration: underline;
        }

        .gh-tag {
            color: #0969da;
            background-color: #ddf4ff;
            border-radius: 2em;
        }
        
        /* Loading animation */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.2); opacity: 0; }
        }
        .loading-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
    </style>
</head>
<body class="bg-[#f6f8fa] text-[#24292f] min-h-screen">

    <!-- Navbar -->
    <nav class="bg-gray-100 border-b border-gray-200 text-[#24292f] py-3">
        <div class="max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <i class="fa-brands fa-github text-3xl"></i>
                    <h1 class="text-sm font-bold tracking-tight">Expert Finder</h1>
                </div>
                <button id="settingsBtn" class="text-gray-600 hover:text-gray-900 transition-colors p-1 rounded-md border border-gray-300 hover:border-gray-400 px-3 text-xs font-semibold">
                    <i class="fa-solid fa-gear mr-1"></i> Settings
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-[1012px] mx-auto px-4 py-8 sm:px-6 lg:px-8">
        
        <!-- Search Section -->
        <div class="flex flex-col items-center justify-center pt-10 pb-8 transition-all duration-500" id="searchContainer">
            <div class="text-center mb-6 max-w-2xl">
                <h2 class="text-3xl font-semibold mb-2 text-[#24292f]">Find Top Minds</h2>
                <p class="text-base text-[#57606a]">Identify experts and contributors in any domain.</p>
            </div>

            <div class="w-full max-w-xl">
                <div class="flex gap-2">
                    <input type="text" id="domainInput" 
                        class="gh-input w-full p-2 px-3 rounded-md text-sm text-[#24292f] placeholder-[#6e7781]" 
                        placeholder="Search a domain (e.g. Quantum Computing)..."
                        autocomplete="off">
                    <button id="findBtn" class="gh-btn-primary px-4 py-1.5 rounded-md text-sm font-semibold whitespace-nowrap">
                        Find Experts
                    </button>
                </div>
                
                <div id="apiKeyWarning" class="hidden mt-3 p-3 rounded-md bg-[#ffebe9] border border-[#ff818266] text-sm text-[#cf222e]">
                    <i class="fa-solid fa-circle-exclamation mr-1"></i> Please configure your Gemini API Key in settings.
                </div>
            </div>
            
            <!-- Tags/Suggestions -->
            <div class="mt-4 flex flex-wrap justify-center gap-2 text-xs text-[#57606a]">
                <span class="mr-1">Trending:</span>
                <button class="suggestion-btn hover:text-[#0969da] hover:underline cursor-pointer">AI Ethics</button>
                <button class="suggestion-btn hover:text-[#0969da] hover:underline cursor-pointer">Rust</button>
                <button class="suggestion-btn hover:text-[#0969da] hover:underline cursor-pointer">Kubernetes</button>
                <button class="suggestion-btn hover:text-[#0969da] hover:underline cursor-pointer">Cryptography</button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsArea" class="hidden opacity-0 transition-opacity duration-500 mt-4">
            <div class="flex items-center justify-between mb-4 border-b border-[#001f3f] pb-3">
                <h3 class="text-lg font-semibold text-[#24292f]" id="resultsTitle">Experts</h3>
                <button id="newSearchBtn" class="text-sm text-[#0969da] hover:underline">Clear search</button>
            </div>
            
            <div id="expertsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Expert cards will be injected here -->
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden flex flex-col items-center justify-center py-20">
            <div class="relative w-16 h-16 mb-4">
                <i class="fa-solid fa-spinner fa-spin text-[#57606a] text-4xl"></i>
            </div>
            <p class="text-base text-[#24292f] font-semibold">Searching...</p>
            <p class="text-sm text-[#57606a]"> querying knowledge graph</p>
        </div>

    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <!-- Background backdrop -->
        <div class="absolute inset-0 bg-[#1b1f24]/50 backdrop-blur-[2px] transition-opacity opacity-0" id="settingsBackdrop"></div>

        <div class="pointer-events-none fixed inset-0 flex items-center justify-center p-4">
            <div class="pointer-events-auto relative transform overflow-hidden rounded-md bg-white shadow-xl border border-[#d0d7de] transition-all sm:w-full sm:max-w-lg opacity-0 scale-95" id="settingsPanel">
                <div class="bg-[#f6f8fa] px-4 py-3 border-b border-[#d0d7de] flex justify-between items-center">
                    <h3 class="text-sm font-semibold text-[#24292f]">Settings</h3>
                    <button id="closeSettingsBtn" class="text-[#57606a] hover:text-[#24292f]">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                
                <div class="p-4 space-y-4">
                    <!-- API Key Input -->
                    <div>
                        <label for="apiKey" class="block text-sm font-semibold text-[#24292f] mb-1">Gemini API Key</label>
                        <div class="relative">
                            <input type="password" name="apiKey" id="apiKey" class="gh-input block w-full rounded-md py-1.5 px-3 text-sm" placeholder="Paste your key here...">
                            <button id="toggleKeyVisibility" class="absolute inset-y-0 right-0 flex items-center pr-3 text-[#57606a] hover:text-[#24292f]">
                                <i class="fa-regular fa-eye"></i>
                            </button>
                        </div>
                        <div class="mt-2 flex justify-between items-center">
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-[#0969da] hover:underline">
                                Get API Key <i class="fa-solid fa-external-link-alt text-[10px]"></i>
                            </a>
                            <button id="testKeyBtn" class="text-xs gh-btn-secondary px-2 py-1 rounded-md font-medium">
                                Test Connection
                            </button>
                        </div>
                        <div id="connectionStatus" class="mt-1 h-4 text-xs"></div>
                    </div>

                    <!-- System Prompt Input -->
                    <div>
                        <label for="systemPrompt" class="block text-sm font-semibold text-[#24292f] mb-1">System Prompt</label>
                        <textarea id="systemPrompt" rows="6" class="gh-input block w-full rounded-md py-1.5 px-3 text-xs font-mono text-[#24292f]" style="resize: vertical;"></textarea>
                        <button id="resetPromptBtn" class="mt-1 text-xs text-[#57606a] hover:text-[#0969da]">Reset default</button>
                    </div>
                </div>

                <div class="bg-[#f6f8fa] px-4 py-3 border-t border-[#d0d7de] flex justify-end gap-2">
                    <button type="button" id="cancelSettingsBtn" class="gh-btn-secondary px-3 py-1.5 rounded-md text-sm font-medium">Cancel</button>
                    <button type="button" id="saveSettingsBtn" class="gh-btn-primary px-3 py-1.5 rounded-md text-sm font-medium">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Constants & Defaults ---
        const DEFAULT_PROMPT = `You are an expert finder. The user is looking for top-tier experts in the field of: {{domain}}. 
Identify 6-8 world-leading figures, researchers, or practitioners in this specific domain.
Return the result strictly as a raw JSON object (no markdown code blocks) with a key "experts" containing an array of objects. 
Each object must have:
- "name": Full name of the expert.
- "affiliation": Current university, company, or organization.
- "role": Job title or primary role.
- "contributions": A concise summary of their key contributions, inventions, or famous works (max 2 sentences).
- "justification": A brief explanation of why they are considered a top expert in this specific field.
- "tags": An array of 2-3 specific sub-topics they are known for.`;

        const STORAGE_KEY_API = 'expert_finder_api_key';
        const STORAGE_KEY_PROMPT = 'expert_finder_system_prompt';
        const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';

        // --- DOM Elements ---
        const els = {
            settingsModal: document.getElementById('settingsModal'),
            settingsBackdrop: document.getElementById('settingsBackdrop'),
            settingsPanel: document.getElementById('settingsPanel'),
            settingsBtn: document.getElementById('settingsBtn'),
            closeSettingsBtn: document.getElementById('closeSettingsBtn'),
            cancelSettingsBtn: document.getElementById('cancelSettingsBtn'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            apiKeyInput: document.getElementById('apiKey'),
            systemPromptInput: document.getElementById('systemPrompt'),
            testKeyBtn: document.getElementById('testKeyBtn'),
            connectionStatus: document.getElementById('connectionStatus'),
            toggleKeyVisibility: document.getElementById('toggleKeyVisibility'),
            resetPromptBtn: document.getElementById('resetPromptBtn'),
            
            domainInput: document.getElementById('domainInput'),
            findBtn: document.getElementById('findBtn'),
            apiKeyWarning: document.getElementById('apiKeyWarning'),
            searchContainer: document.getElementById('searchContainer'),
            resultsArea: document.getElementById('resultsArea'),
            resultsTitle: document.getElementById('resultsTitle'),
            expertsGrid: document.getElementById('expertsGrid'),
            loadingState: document.getElementById('loadingState'),
            newSearchBtn: document.getElementById('newSearchBtn'),
            suggestionBtns: document.querySelectorAll('.suggestion-btn')
        };

        // --- State ---
        let state = {
            apiKey: localStorage.getItem(STORAGE_KEY_API) || '',
            prompt: localStorage.getItem(STORAGE_KEY_PROMPT) || DEFAULT_PROMPT
        };

        // --- Initialization ---
        function init() {
            els.apiKeyInput.value = state.apiKey;
            els.systemPromptInput.value = state.prompt;
        }

        // --- Settings Modal Logic ---
        function toggleSettings(show) {
            if (show) {
                els.settingsModal.classList.remove('hidden');
                void els.settingsModal.offsetWidth;
                els.settingsBackdrop.classList.remove('opacity-0');
                els.settingsPanel.classList.remove('opacity-0', 'scale-95');
                els.settingsPanel.classList.add('opacity-100', 'scale-100');
            } else {
                els.settingsBackdrop.classList.add('opacity-0');
                els.settingsPanel.classList.remove('opacity-100', 'scale-100');
                els.settingsPanel.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    els.settingsModal.classList.add('hidden');
                    els.connectionStatus.textContent = ''; 
                }, 200);
            }
        }

        els.settingsBtn.addEventListener('click', () => toggleSettings(true));
        els.closeSettingsBtn.addEventListener('click', () => toggleSettings(false));
        els.cancelSettingsBtn.addEventListener('click', () => {
            els.apiKeyInput.value = state.apiKey;
            els.systemPromptInput.value = state.prompt;
            toggleSettings(false);
        });

        els.saveSettingsBtn.addEventListener('click', () => {
            const newKey = els.apiKeyInput.value.trim();
            const newPrompt = els.systemPromptInput.value.trim();
            
            state.apiKey = newKey;
            state.prompt = newPrompt;
            
            localStorage.setItem(STORAGE_KEY_API, newKey);
            localStorage.setItem(STORAGE_KEY_PROMPT, newPrompt);
            
            els.apiKeyWarning.classList.add('hidden');
            toggleSettings(false);
        });

        els.resetPromptBtn.addEventListener('click', () => {
            els.systemPromptInput.value = DEFAULT_PROMPT;
        });

        els.toggleKeyVisibility.addEventListener('click', () => {
            const type = els.apiKeyInput.type === 'password' ? 'text' : 'password';
            els.apiKeyInput.type = type;
            els.toggleKeyVisibility.innerHTML = type === 'password' ? '<i class="fa-regular fa-eye"></i>' : '<i class="fa-regular fa-eye-slash"></i>';
        });

        // --- API & Search Logic ---

        async function testConnection() {
            const key = els.apiKeyInput.value.trim();
            if (!key) {
                showStatus('Please enter a key first.', 'text-[#cf222e]');
                return;
            }

            showStatus('Testing...', 'text-[#57606a]');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "Hello" }] }]
                    })
                });

                if (response.ok) {
                    showStatus('Connection successful', 'text-[#1a7f37]');
                } else {
                    const data = await response.json();
                    showStatus(`Error: ${data.error?.message || response.statusText}`, 'text-[#cf222e]');
                }
            } catch (e) {
                showStatus('Network error or invalid request.', 'text-[#cf222e]');
            }
        }

        function showStatus(msg, colorClass) {
            els.connectionStatus.textContent = msg;
            els.connectionStatus.className = `mt-1 h-4 text-xs font-medium ${colorClass}`;
        }

        els.testKeyBtn.addEventListener('click', testConnection);

        async function findExperts(domain) {
            if (!state.apiKey) {
                els.apiKeyWarning.classList.remove('hidden');
                return;
            }

            els.searchContainer.classList.add('opacity-50', 'pointer-events-none');
            els.loadingState.classList.remove('hidden');
            els.resultsArea.classList.add('hidden');
            els.expertsGrid.innerHTML = '';

            const prompt = state.prompt.replace('{{domain}}', domain);

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${state.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    })
                });

                if (!response.ok) throw new Error('API Request Failed');

                const data = await response.json();
                let text = data.candidates[0].content.parts[0].text;
                text = text.replace(/```json/g, '').replace(/```/g, '');

                const parsed = JSON.parse(text);
                renderResults(domain, parsed.experts);

            } catch (error) {
                console.error(error);
                els.expertsGrid.innerHTML = `
                    <div class="col-span-full py-6 text-center">
                        <div class="inline-block p-4 rounded-md bg-[#ffebe9] border border-[#ff818266] text-[#cf222e] text-sm">
                            <i class="fa-solid fa-circle-exclamation mr-1"></i>
                            ${error.message}. Check your API key.
                        </div>
                    </div>
                `;
                els.resultsArea.classList.remove('hidden');
                els.resultsArea.classList.remove('opacity-0');
            } finally {
                els.loadingState.classList.add('hidden');
                els.searchContainer.classList.remove('opacity-50', 'pointer-events-none');
            }
        }

        function renderResults(domain, experts) {
            els.resultsTitle.textContent = `Results for "${domain}"`;
            els.resultsArea.classList.remove('hidden');
            setTimeout(() => els.resultsArea.classList.remove('opacity-0'), 10);

            if (!experts || experts.length === 0) {
                els.expertsGrid.innerHTML = '<p class="text-center col-span-full text-[#57606a]">No experts found.</p>';
                return;
            }

            experts.forEach((expert, index) => {
                const delay = index * 50;
                const card = document.createElement('div');
                card.className = `gh-card p-4 hover:shadow-sm transition-all duration-200 transform translate-y-2 opacity-0 flex flex-col`;
                card.style.animation = `fadeInUp 0.3s ease forwards ${delay}ms`;

                const tagsHtml = expert.tags ? expert.tags.map(t => 
                    `<span class="gh-tag px-2 py-0.5 text-xs font-medium mr-1 mb-1 border border-[#ddf4ff] hover:bg-[#b6e3ff] transition-colors cursor-default">${t}</span>`
                ).join('') : '';

                card.innerHTML = `
                    <div class="flex items-start justify-between mb-2">
                        <div>
                            <div class="flex items-center gap-2">
                                <i class="fa-regular fa-id-card text-[#57606a]"></i>
                                <h4 class="text-base font-bold">
                                    <a href="https://www.google.com/search?q=${encodeURIComponent(expert.name + ' ' + expert.affiliation)}" target="_blank" class="gh-link">
                                        ${expert.name}
                                    </a>
                                </h4>
                            </div>
                            <p class="text-xs text-[#57606a] mt-1">${expert.role || 'Expert'} at ${expert.affiliation}</p>
                        </div>
                    </div>
                    
                    <p class="text-sm text-[#57606a] mb-3 leading-relaxed flex-grow">
                        ${expert.justification}
                    </p>

                    <div class="text-xs text-[#57606a] mb-3">
                        <strong class="text-[#24292f]">Known for:</strong> ${expert.contributions}
                    </div>

                    <div class="mt-auto pt-2 flex flex-wrap gap-y-1">
                        ${tagsHtml}
                    </div>
                `;
                els.expertsGrid.appendChild(card);
            });
        }

        // --- Event Listeners ---
        els.findBtn.addEventListener('click', () => {
            const domain = els.domainInput.value.trim();
            if (domain) findExperts(domain);
        });

        els.domainInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const domain = els.domainInput.value.trim();
                if (domain) findExperts(domain);
            }
        });

        els.newSearchBtn.addEventListener('click', () => {
            els.resultsArea.classList.add('opacity-0');
            setTimeout(() => {
                els.resultsArea.classList.add('hidden');
                els.domainInput.value = '';
                els.domainInput.focus();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 500);
        });

        els.suggestionBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                els.domainInput.value = e.target.textContent;
                findExperts(e.target.textContent);
            });
        });

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(styleSheet);

        init();
    </script>
</body>
</html>
